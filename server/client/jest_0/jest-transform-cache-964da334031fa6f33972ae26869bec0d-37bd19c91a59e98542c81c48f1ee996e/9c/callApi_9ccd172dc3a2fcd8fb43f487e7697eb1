b8f372abf0b3813e0625ebb371135178
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

var _services = require("./services");

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    (0, _services.postCall)("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    (0, _services.authenticatedGetCall)("orders/" + orderId).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      } else if (result.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    (0, _services.putCall)("orders/" + orderId, updateOps).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    (0, _services.authenticatedGetCall)("orders/all/" + _config.apiConfig.userId).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      } else if (result.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    (0, _services.authenticatedGetCall)("items/").then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      } else if (result.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.getMenuItems = getMenuItems;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsidXNlckxvZ2luIiwiY3JlZGVudGlhbHMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiVU5SRUNPR05JWkVEX0VSUk9SIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJOT1RfRk9VTkQiLCJ1cGRhdGVPcmRlciIsInVwZGF0ZU9wcyIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR08sTUFBTUEsU0FBUyxHQUFJQyxXQUFELElBQWlCO0FBQ3RDLFNBQU8sSUFBSUMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyw0QkFBUyxhQUFULEVBQXdCSCxXQUF4QixFQUNLSSxJQURMLENBQ1VDLE1BQU0sSUFBSTtBQUNaLFVBQUlBLE1BQU0sQ0FBQ0MsTUFBUCxLQUFrQkMseUJBQVdDLEVBQWpDLEVBQXFDO0FBQ2pDQywwQkFBVUMsbUJBQVYsR0FBZ0NMLE1BQU0sQ0FBQ00sSUFBUCxDQUFZQyxLQUE1QztBQUNBSCwwQkFBVUksTUFBVixHQUFtQlIsTUFBTSxDQUFDTSxJQUFQLENBQVlHLEVBQS9CO0FBQ0FaLFFBQUFBLE9BQU8sQ0FBQ0csTUFBRCxDQUFQO0FBQ0g7QUFDSixLQVBMLEVBUUtVLEtBUkwsQ0FRV0Ms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TDtBQXdCSCxHQXpCTSxDQUFQO0FBMEJILENBM0JNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBpQ29uZmlnIH0gZnJvbSAnLi4vYXBpQ2FsbHMvY29uZmlnJztcbmltcG9ydCB7IGVycm9yIH0gZnJvbSAnLi9lcnJvckNvbnN0YW50cyc7XG5pbXBvcnQgSHR0cFN0YXR1cyBmcm9tICdodHRwLXN0YXR1cy1jb2Rlcyc7XG5pbXBvcnQgeyBwb3N0Q2FsbCwgYXV0aGVudGljYXRlZEdldENhbGwsIHB1dENhbGwgfSBmcm9tICcuL3NlcnZpY2VzJztcblxuXG5leHBvcnQgY29uc3QgdXNlckxvZ2luID0gKGNyZWRlbnRpYWxzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcG9zdENhbGwoXCJ1c2Vycy9sb2dpblwiLCBjcmVkZW50aWFscylcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gPSByZXN1bHQuZGF0YS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLnVzZXJJZCA9IHJlc3VsdC5kYXRhLmlkO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuQVVUSF9GQUlMRUQuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLkFVVEhfRkFJTEVELkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5cbmV4cG9ydCBjb25zdCBnZXRPcmRlckl0ZW1zID0gKG9yZGVySWQpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9cIiArIG9yZGVySWQpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5OT1RfRk9VTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlVOUkVDT0dOSVpFRF9FUlJPUi5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5cbmV4cG9ydCBjb25zdCB1cGRhdGVPcmRlciA9IChvcmRlcklkLCB1cGRhdGVPcHMpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBwdXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZCwgdXBkYXRlT3BzKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuXG5leHBvcnQgY29uc3QgZ2V0VXNlcnNPcmRlcnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYXBpQ29uZmlnLnVzZXJJZCk7XG4gICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL2FsbC9cIiArIGFwaUNvbmZpZy51c2VySWQpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5OT1RfRk9VTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlVOUkVDT0dOSVpFRF9FUlJPUi5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5cbmV4cG9ydCBjb25zdCBnZXRNZW51SXRlbXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJpdGVtcy9cIilcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuXG4iXX0=