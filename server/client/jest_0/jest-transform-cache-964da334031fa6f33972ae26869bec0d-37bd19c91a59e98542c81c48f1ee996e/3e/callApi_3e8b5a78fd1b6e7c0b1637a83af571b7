836734803e1b3983d9e7e72fb7101314
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.post(callingUrl, mydata)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject(err);
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject(err);
      } else {
        console.log();
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.get(callingUrl, requestHeader).then(response => {
      return response;
    }));
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJDUkVBVEVEIiwiaGVhZGVyIiwicmVxdWVzdEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJwdXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLE9BQU8sR0FBRyx3QkFBaEI7O0FBRU8sTUFBTUMsU0FBUyxHQUFJQyxXQUFELElBQWlCO0FBQ3RDLFNBQU8sSUFBSUMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQ0MsSUFBQUEsUUFBUSxDQUFDLGFBQUQsRUFBZ0JKLFdBQWhCLENBQVIsQ0FDS0ssSUFETCxDQUNVQyxNQUFNLElBQUk7QUFDWixVQUFJQSxNQUFNLENBQUNDLE1BQVAsS0FBa0JDLHlCQUFXQyxFQUFqQyxFQUFxQztBQUNqQ0Ms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LGtCQUFVQztBQUF6QztBQUFYLEdBQXRCO0FBRUEsU0FBTyxJQUFJVixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDLFFBQUlxQyxVQUFVLEdBQUcxQyxPQUFPLEdBQUd3QyxHQUEzQjtBQUNBcEMsSUFBQUEsT0FBTyxDQUFDdUMsZUFBTU0sR0FBTixDQUFVUCxVQUFWLEVBQXNCSyxhQUF0QixFQUNIeEMsSUFERyxDQUNFYSxRQUFRLElBQUk7QUFDZCxhQUFPQSxRQUFQO0FBQ0gsS0FIRyxDQUFELENBQVA7QUFJSCxHQU5NLENBQVA7QUFPSDs7QUFHRCxTQUFTZSxPQUFULENBQWlCSyxHQUFqQixFQUFzQk4sU0FBdEIsRUFBaUM7QUFDN0IsU0FBTyxJQUFJL0IsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxRQUFJcUMsVUFBVSxHQUFHMUMsT0FBTyxHQUFHd0MsR0FBM0I7QUFDQXBDLElBQUFBLE9BQU8sQ0FBQ3VDLGVBQU1PLEdBQU4sQ0FBVVIsVUFBVixFQUFzQlIsU0FBdEIsRUFDSDNCLElBREcsQ0FDRWEsUUFBUSxJQUFJO0FBQ2QsYUFBT0EsUUFBUDtBQUNILEtBSEcsQ0FBRCxDQUFQO0FBSUgsR0FOTSxDQUFQO0FBT0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcGlDb25maWcgfSBmcm9tICcuLi9hcGlDYWxscy9jb25maWcnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IGVycm9yIH0gZnJvbSAnLi9lcnJvckNvbnN0YW50cyc7XG5pbXBvcnQgSHR0cFN0YXR1cyBmcm9tICdodHRwLXN0YXR1cy1jb2Rlcyc7XG5cbmNvbnN0IGJhc2VVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9cIjtcblxuZXhwb3J0IGNvbnN0IHVzZXJMb2dpbiA9IChjcmVkZW50aWFscykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHBvc3RDYWxsKFwidXNlcnMvbG9naW5cIiwgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwaUNvbmZpZy5hdXRoZW50aWNhdGlvblRva2VuID0gcmVzdWx0LmRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgICAgIGFwaUNvbmZpZy51c2VySWQgPSByZXN1bHQuZGF0YS5pZDtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLkFVVEhfRkFJTEVELk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5BVVRIX0ZBSUxFRC5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBnZXRPcmRlckl0ZW1zID0gKG9yZGVySWQpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZClcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG5cblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBjb25zdCB1cGRhdGVPcmRlciA9IChvcmRlcklkLCB1cGRhdGVPcHMpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHB1dENhbGwoXCJvcmRlcnMvXCIgKyBvcmRlcklkLCB1cGRhdGVPcHMpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8vIHRoaXMgbmVlZHMgdG8gYmUgY2hhbmdlZFxuICAgIGV4cG9ydCBjb25zdCBnZXRVc2Vyc09yZGVycyA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFwaUNvbmZpZy51c2VySWQpO1xuICAgICAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvYWxsL1wiICsgYXBpQ29uZmlnLnVzZXJJZClcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgZXhwb3J0IGNvbnN0IGdldE1lbnVJdGVtcyA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwiaXRlbXMvXCIpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8qXG4gICAgICAgIFBPU1QsIEdFVCwgUFVUIGNhbGxzIGRlZmluZWRcbiAgICAgKi9cblxuICAgIGZ1bmN0aW9uIHBvc3RDYWxsKHVybCwgbXlkYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgICAgICAvLyByZXNvbHZlKGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAgICAgLy8gICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgLy8gICAgIH0pKTtcbiAgICAgICAgICAgIGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSyB8fCByZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuQ1JFQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gYXV0aGVudGljYXRlZEdldENhbGwodXJsLCBoZWFkZXIpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdEhlYWRlciA9IHsgaGVhZGVyczogeyBcIkF1dGhvcml6YXRpb25cIjogXCJCZWFyZXIgXCIgKyBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiB9IH07XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIHJlc29sdmUoYXhpb3MuZ2V0KGNhbGxpbmdVcmwsIHJlcXVlc3RIZWFkZXIpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHB1dENhbGwodXJsLCB1cGRhdGVPcHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIHJlc29sdmUoYXhpb3MucHV0KGNhbGxpbmdVcmwsIHVwZGF0ZU9wcylcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0iXX0=