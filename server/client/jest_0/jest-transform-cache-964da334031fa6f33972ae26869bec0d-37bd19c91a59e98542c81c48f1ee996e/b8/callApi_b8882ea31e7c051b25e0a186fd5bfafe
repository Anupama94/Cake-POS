6d409dce626bcf09e7fd74a65f57dc0d
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      } else if (result.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        console.log("Unauthorized request initiated from axios post call in callApi.js");
        reject(err);
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios post call in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios post call in callApi.js");
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.get(callingUrl, requestHeader).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.response.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios authenticatedGetCall in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios authenticatedGetCall in callApi.js");
        reject(err);
      }
    });
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.put(callingUrl, updateOps)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.put(callingUrl, updateOps).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.NO_CONTENT || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios putCall in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from axios putCall in callApi.js");
        reject(err);
      }
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiVU5SRUNPR05JWkVEX0VSUk9SIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsIk5PVF9GT1VORCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJDUkVBVEVEIiwiVU5FWFBFQ1RFRF9FUlJPUiIsImhlYWRlciIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0IiwicHV0IiwiTk9fQ09OVEVOVCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHLHdCQUFoQjs7QUFFTyxNQUFNQyxTQUFTLEdBQUlDLFdBQUQsSUFBaUI7QUFDdEMsU0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDQyxJQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFnQkosV0FBaEIsQ0FBUixDQUNLSyxJQURMLENBQ1VDLE1BQU0s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fSBmcm9tICcuLi9hcGlDYWxscy9jb25maWcnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IGVycm9yIH0gZnJvbSAnLi9lcnJvckNvbnN0YW50cyc7XG5pbXBvcnQgSHR0cFN0YXR1cyBmcm9tICdodHRwLXN0YXR1cy1jb2Rlcyc7XG5cbmNvbnN0IGJhc2VVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9cIjtcblxuZXhwb3J0IGNvbnN0IHVzZXJMb2dpbiA9IChjcmVkZW50aWFscykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHBvc3RDYWxsKFwidXNlcnMvbG9naW5cIiwgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwaUNvbmZpZy5hdXRoZW50aWNhdGlvblRva2VuID0gcmVzdWx0LmRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgICAgIGFwaUNvbmZpZy51c2VySWQgPSByZXN1bHQuZGF0YS5pZDtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLkFVVEhfRkFJTEVELk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5BVVRIX0ZBSUxFRC5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlVOUkVDT0dOSVpFRF9FUlJPUi5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IGdldE9yZGVySXRlbXMgPSAob3JkZXJJZCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuU0VSVklDRV9VTkFWQUlMQUJMRS5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlVOUkVDT0dOSVpFRF9FUlJPUi5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cblxuZXhwb3J0IGNvbnN0IHVwZGF0ZU9yZGVyID0gKG9yZGVySWQsIHVwZGF0ZU9wcykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHB1dENhbGwoXCJvcmRlcnMvXCIgKyBvcmRlcklkLCB1cGRhdGVPcHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LKXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgXG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cblxuLy8gdGhpcyBuZWVkcyB0byBiZSBjaGFuZ2VkXG5leHBvcnQgY29uc3QgZ2V0VXNlcnNPcmRlcnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYXBpQ29uZmlnLnVzZXJJZCk7XG4gICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL2FsbC9cIiArIGFwaUNvbmZpZy51c2VySWQpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgfSk7XG59XG5cblxuZXhwb3J0IGNvbnN0IGdldE1lbnVJdGVtcyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIml0ZW1zL1wiKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgIH0pO1xufVxuXG5cbi8qXG4gICAgUE9TVCwgR0VULCBQVVQgY2FsbHMgZGVmaW5lZFxuICovXG5cbmZ1bmN0aW9uIHBvc3RDYWxsKHVybCwgbXlkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICBheGlvcy5wb3N0KGNhbGxpbmdVcmwsIG15ZGF0YSlcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5DUkVBVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVuYXV0aG9yaXplZCByZXF1ZXN0IGluaXRpYXRlZCBmcm9tIGF4aW9zIHBvc3QgY2FsbCBpbiBjYWxsQXBpLmpzXCIpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IgaW5pdGlhdGVkIGZyb20gYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IuVU5FWFBFQ1RFRF9FUlJPUi5NRVNTQUdFICsgXCIgaW5pdGlhdGVkIGZyb20gIGF4aW9zIHBvc3QgY2FsbCBpbiBjYWxsQXBpLmpzXCIpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBhdXRoZW50aWNhdGVkR2V0Q2FsbCh1cmwsIGhlYWRlcikge1xuICAgIGNvbnN0IHJlcXVlc3RIZWFkZXIgPSB7IGhlYWRlcnM6IHsgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gfSB9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICBheGlvcy5nZXQoY2FsbGluZ1VybCwgcmVxdWVzdEhlYWRlcilcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LIHx8IHJlc3BvbnNlLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5OT1RfRk9VTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludGVybmFsIFNlcnZlciBFcnJvciBpbml0aWF0ZWQgZnJvbSBheGlvcyBhdXRoZW50aWNhdGVkR2V0Q2FsbCBpbiBjYWxsQXBpLmpzXCIpXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IuVU5FWFBFQ1RFRF9FUlJPUi5NRVNTQUdFICsgXCIgaW5pdGlhdGVkIGZyb20gIGF4aW9zIGF1dGhlbnRpY2F0ZWRHZXRDYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gcHV0Q2FsbCh1cmwsIHVwZGF0ZU9wcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgLy8gcmVzb2x2ZShheGlvcy5wdXQoY2FsbGluZ1VybCwgdXBkYXRlT3BzKVxuICAgICAgICAvLyAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAvLyAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgLy8gICAgIH0pKTtcblxuICAgICAgICBheGlvcy5wdXQoY2FsbGluZ1VybCwgdXBkYXRlT3BzKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5OT19DT05URU5UIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5DUkVBVEVEKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IgaW5pdGlhdGVkIGZyb20gYXhpb3MgcHV0Q2FsbCBpbiBjYWxsQXBpLmpzXCIpXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5VTkVYUEVDVEVEX0VSUk9SLk1FU1NBR0UgKyBcIiBpbml0aWF0ZWQgZnJvbSBheGlvcyBwdXRDYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSJdfQ==