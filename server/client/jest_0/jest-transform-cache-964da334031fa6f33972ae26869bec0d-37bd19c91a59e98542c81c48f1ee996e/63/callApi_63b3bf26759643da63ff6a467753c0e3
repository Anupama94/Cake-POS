5feeb226f92af873f766e7f11286ccc4
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = _interopRequireDefault(require("./errorConstants"));

const baseUrl = "http://localhost:3001/";
const requestHeader = {
  headers: {
    "Authorization": "Bearer " + _config.apiConfig.authenticationToken
  }
};

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === 200) {
        console.log(result);
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      console.log("rejected");

      if (err.response.status === 401) {
        reject({
          message: _errorConstants.default.AUTH_FAILED.MESSAGE,
          code: _errorConstants.default.AUTH_FAILED.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.post(callingUrl, mydata)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === 200 || response.status === 201 || response.status === 401) {
        resolve(response);
      } else if (response.status === 500) {
        console.log("error calling api post call");
        reject();
      } else {
        console.log("unexpected error code");
        reject();
      }
    }).catch(err => {
      if (err.response.status === 401) {
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.get(callingUrl, requestHeader).then(response => {
      return response;
    }));
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiYXBpQ29uZmlnIiwiYXV0aGVudGljYXRpb25Ub2tlbiIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwibWVzc2FnZSIsImVycm9yQ29uc3RhbnRzIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJnZXRPcmRlckl0ZW1zIiwib3JkZXJJZCIsImF1dGhlbnRpY2F0ZWRHZXRDYWxsIiwidXBkYXRlT3JkZXIiLCJ1cGRhdGVPcHMiLCJwdXRDYWxsIiwiZ2V0VXNlcnNPcmRlcnMiLCJnZXRNZW51SXRlbXMiLCJ1cmwiLCJteWRhdGEiLCJjYWxsaW5nVXJsIiwiYXhpb3MiLCJwb3N0IiwiaGVhZGVyIiwiZ2V0IiwicHV0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUcsd0JBQWhCO0FBRUEsTUFBTUMsYUFBYSxHQUFHO0FBQUVDLEVBQUFBLE9BQU8sRUFBRTtBQUFFLHFCQUFpQixZQUFZQyxrQkFBVUM7QUFBekM7QUFBWCxDQUF0Qjs7QUFFTyxNQUFNQyxTQUFTLEdBQUlDLFdBQUQsSUFBaUI7QUFDdEMsU0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDQyxJQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFnQkosV0FBaEIsQ0FBUixDQUNLSyxJQURMLENBQ1VDLE1BQU0sSUFBSTtBQUNaLFVBQUlBLE1BQU0sQ0FBQ0MsTUFBUCxLQUFrQixHQUF0QixFQUEwQjtBQUN0QkMsUUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlILE1BQVo7QUFDQVQsMEJBQVVDLG1CQUFWLEdBQWdDUSxNQUFNLENBQUNJLElBQVAsQ0FBWUMsS0FBNUM7QUFDQWQsMEJBQVVlLE1BQVYsR0FBbUJOLE1BQU0sQ0FBQ0ksSUFBUCxDQUFZRyxFQUEvQjtBQUNBWCxRQUFBQSxPQUFPO0FBQ1Y7QUFJSixLQVhMLEVBWUtZLEtBWkwsQ0FZV0MsR0FBRyxJQUFJO0FBQ1ZQLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFVBQVo7O0FBQ0EsVUFBSU0sR0FBRyxDQUFDQyxRQUFKLENBQWFULE1BQWIsS0FBd0IsR0FBNUIsRUFBZ0M7QUFFNUJKLFFBQUFBLE1BQU0sQ0FBQztBQUNIYyxVQUFBQSxPQUFPLEVBQUVDLHdCQUFlQyxXQUFmLENBQTJCQyxPQURqQztBQUVIQyxVQUFBQSxJQUFJLEVBQUVILHdCQUFlQyxXQUFmLENBQTJCRztBQUY5QixTQUFELENBQU47QUFJSDtBQUVKLEtBdEJMO0FBdUJILEdBeEJNLENBQVA7QUF5QkgsQ0ExQk07Ozs7QUE0QkEsTUFBTUMsYUFBYSxHQUFJQyxPQUFELElBQWE7QUFDdEMsU0FBTyxJQUFJdkIsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQ3NCLElBQUFBLG9CQUFvQixDQUFDLFlBQVVELE9BQVgsQ0FBcEIsQ0FDS25CLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1pKLE1BQUFBLE9BQU8sQ0FBQ0ksTUFBRCxDQUFQO0FBR0gsS0FMTCxFQU1LUSxLQU5MLENBTVdDLEdBQUcsSUFBSTtBQUFDWixNQUFBQSxNQUFNO0FBQUcsS0FONUI7QUFPSCxHQVJNLENBQVA7QUFTSCxDQVZNOzs7O0FBYUEsTUFBTXVCLFdBQVcsR0FBRyxDQUFDRixPQUFELEVBQVVHLFNBQVYsS0FBd0I7QUFDL0MsU0FBTyxJQUFJMUIsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQ3lCLElBQUFBLE9BQU8sQ0FBQyxZQUFZSixPQUFiLEVBQXNCRyxTQUF0QixDQUFQLENBQ0t0QixJQURMLENBQ1VDLE1BQU0sSUFBSTtBQUNaSixNQUFBQSxPQUFPLENBQUNJLE1BQUQsQ0FBUDtBQUNILEtBSEwsRUFJS1EsS0FKTCxDQUlXQyxHQUFHLElBQUk7QUFBQ1osTUFBQUEsTUFBTTtBQUFHLEtBSjVCO0FBS0gsR0FOTSxDQUFQO0FBT0gsQ0FSTSxDLENBV1A7Ozs7O0FBQ08sTUFBTTBCLGNBQWMsR0FBRyxNQUFNO0FBQ2hDLFNBQU8sSUFBSTVCLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcENLLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZWixrQkFBVWUsTUFBdEI7QUFDQWEsSUFBQUEsb0JBQW9CLENBQUMsZ0JBQWdCNUIsa0JBQVVlLE1BQTNCLENBQXBCLENBQ0tQLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1pKLE1BQUFBLE9BQU8sQ0FBQ0ksTUFBRCxDQUFQO0FBQ0gsS0FITCxFQUlLUSxLQUpMLENBSVdDLEdBQUcsSUFBSTtBQUFDWixNQUFBQSxNQUFNO0FBQUcsS0FKNUI7QUFLSCxHQVBNLENBQVA7QUFRSCxDQVRNOzs7O0FBWUEsTUFBTTJCLFlBQVksR0FBRyxNQUFNO0FBQzlCLFNBQU8sSUFBSTdCLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcENzQixJQUFBQSxvQkFBb0IsQ0FBQyxRQUFELENBQXBCLENBQ0twQixJQURMLENBQ1VDLE1BQU0sSUFBSTtBQUNaSixNQUFBQSxPQUFPLENBQUNJLE1BQUQsQ0FBUDtBQUNILEtBSEwsRUFJS1EsS0FKTCxDQUlXQyxHQUFHLElBQUk7QUFBQ1osTUFBQUEsTUFBTTtBQUFHLEtBSjVCO0FBS0gsR0FOTSxDQUFQO0FBT0gsQ0FSTTtBQVdQOzs7Ozs7O0FBSUEsU0FBU0MsUUFBVCxDQUFrQjJCLEdBQWxCLEVBQXVCQyxNQUF2QixFQUErQjtBQUMzQixTQUFPLElBQUkvQixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDLFFBQUk4QixVQUFVLEdBQUd2QyxPQUFPLEdBQUdxQyxHQUEzQixDQURvQyxDQUVwQztBQUNBO0FBQ0E7QUFDQTs7QUFDQUcsbUJBQU1DLElBQU4sQ0FBV0YsVUFBWCxFQUF1QkQsTUFBdkIsRUFDTTNCLElBRE4sQ0FDV1csUUFBUSxJQUFJO0FBQ2QsVUFBSUEsUUFBUSxDQUFDVCxNQUFULEtBQW9CLEdBQXBCLElBQTJCUyxRQUFRLENBQUNULE1BQVQsS0FBb0IsR0FBL0MsSUFBc0RTLFFBQVEsQ0FBQ1QsTUFBVCxLQUFvQixHQUE5RSxFQUFtRjtBQUUvRUwsUUFBQUEsT0FBTyxDQUFDYyxRQUFELENBQVA7QUFDSCxPQUhELE1BSUssSUFBSUEsUUFBUSxDQUFDVCxNQUFULEtBQW9CLEdBQXhCLEVBQTRCO0FBQzdCQyxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSw2QkFBWjtBQUNBTixRQUFBQSxNQUFNO0FBQ1QsT0FISSxNQUlBO0FBQ0ZLLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHVCQUFaO0FBQ0FOLFFBQUFBLE1BQU07QUFDUjtBQUNKLEtBZE4sRUFnQk1XLEtBaEJOLENBZ0JZQyxHQUFHLElBQUk7QUFDWCxVQUFJQSxHQUFHLENBQUNDLFFBQUosQ0FBYVQsTUFBYixLQUF3QixHQUE1QixFQUFnQztBQUM1QkosUUFBQUEsTUFBTSxDQUFDWSxHQUFELENBQU47QUFDSDtBQUNILEtBcEJOO0FBcUJILEdBM0JNLENBQVA7QUE0Qkg7O0FBR0QsU0FBU1Usb0JBQVQsQ0FBOEJNLEdBQTlCLEVBQW1DSyxNQUFuQyxFQUEyQztBQUN2QyxRQUFNekMsYUFBYSxHQUFHO0FBQUVDLElBQUFBLE9BQU8sRUFBRTtBQUFFLHVCQUFpQixZQUFZQyxrQkFBVUM7QUFBekM7QUFBWCxHQUF0QjtBQUVBLFNBQU8sSUFBSUcsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxRQUFJOEIsVUFBVSxHQUFHdkMsT0FBTyxHQUFHcUMsR0FBM0I7QUFDQTdCLElBQUFBLE9BQU8sQ0FBQ2dDLGVBQU1HLEdBQU4sQ0FBVUosVUFBVixFQUFzQnRDLGFBQXRCLEVBQ0hVLElBREcsQ0FDRVcsUUFBUSxJQUFJO0FBQ2QsYUFBT0EsUUFBUDtBQUNILEtBSEcsQ0FBRCxDQUFQO0FBSUgsR0FOTSxDQUFQO0FBT0g7O0FBR0QsU0FBU1ksT0FBVCxDQUFpQkcsR0FBakIsRUFBc0JKLFNBQXRCLEVBQWlDO0FBQzdCLFNBQU8sSUFBSTFCLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcEMsUUFBSThCLFVBQVUsR0FBR3ZDLE9BQU8sR0FBR3FDLEdBQTNCO0FBQ0E3QixJQUFBQSxPQUFPLENBQUNnQyxlQUFNSSxHQUFOLENBQVVMLFVBQVYsRUFBcUJOLFNBQXJCLEVBQ0h0QixJQURHLENBQ0VXLFFBQVEsSUFBSTtBQUNkLGFBQU9BLFFBQVA7QUFDSCxLQUhHLENBQUQsQ0FBUDtBQUlILEdBTk0sQ0FBUDtBQU9IIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBpQ29uZmlnIH0gZnJvbSAnLi4vYXBpQ2FsbHMvY29uZmlnJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgZXJyb3JDb25zdGFudHMgZnJvbSAnLi9lcnJvckNvbnN0YW50cyc7XG5cbmNvbnN0IGJhc2VVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9cIjtcblxuY29uc3QgcmVxdWVzdEhlYWRlciA9IHsgaGVhZGVyczogeyBcIkF1dGhvcml6YXRpb25cIjogXCJCZWFyZXIgXCIgKyBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiB9IH1cblxuZXhwb3J0IGNvbnN0IHVzZXJMb2dpbiA9IChjcmVkZW50aWFscykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHBvc3RDYWxsKFwidXNlcnMvbG9naW5cIiwgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiA9IHJlc3VsdC5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcudXNlcklkID0gcmVzdWx0LmRhdGEuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG5cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVqZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSl7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JDb25zdGFudHMuQVVUSF9GQUlMRUQuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yQ29uc3RhbnRzLkFVVEhfRkFJTEVELkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBnZXRPcmRlckl0ZW1zID0gKG9yZGVySWQpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9cIitvcmRlcklkKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG5cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge3JlamVjdCgpfSk7XG4gICAgfSk7XG59XG5cblxuZXhwb3J0IGNvbnN0IHVwZGF0ZU9yZGVyID0gKG9yZGVySWQsIHVwZGF0ZU9wcykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHB1dENhbGwoXCJvcmRlcnMvXCIgKyBvcmRlcklkLCB1cGRhdGVPcHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtyZWplY3QoKX0pO1xuICAgIH0pO1xufVxuXG5cbi8vIHRoaXMgbmVlZHMgdG8gYmUgY2hhbmdlZFxuZXhwb3J0IGNvbnN0IGdldFVzZXJzT3JkZXJzID0gKCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGFwaUNvbmZpZy51c2VySWQpO1xuICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9hbGwvXCIgKyBhcGlDb25maWcudXNlcklkKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7cmVqZWN0KCl9KTtcbiAgICB9KTtcbn1cblxuXG5leHBvcnQgY29uc3QgZ2V0TWVudUl0ZW1zID0gKCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwiaXRlbXMvXCIpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtyZWplY3QoKX0pO1xuICAgIH0pO1xufVxuXG5cbi8qXG4gICAgUE9TVCwgR0VULCBQVVQgY2FsbHMgZGVmaW5lZFxuICovXG5cbmZ1bmN0aW9uIHBvc3RDYWxsKHVybCwgbXlkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICAvLyByZXNvbHZlKGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAvLyAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAvLyAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgLy8gICAgIH0pKTtcbiAgICAgICAgYXhpb3MucG9zdChjYWxsaW5nVXJsLCBteWRhdGEpXG4gICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDEgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKXtcbiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgY2FsbGluZyBhcGkgcG9zdCBjYWxsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidW5leHBlY3RlZCBlcnJvciBjb2RlXCIpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICApXG4gICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSl7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBhdXRoZW50aWNhdGVkR2V0Q2FsbCh1cmwsIGhlYWRlcikge1xuICAgIGNvbnN0IHJlcXVlc3RIZWFkZXIgPSB7IGhlYWRlcnM6IHsgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gfSB9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICByZXNvbHZlKGF4aW9zLmdldChjYWxsaW5nVXJsLCByZXF1ZXN0SGVhZGVyKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBwdXRDYWxsKHVybCwgdXBkYXRlT3BzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICByZXNvbHZlKGF4aW9zLnB1dChjYWxsaW5nVXJsLHVwZGF0ZU9wcylcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9KSk7XG4gICAgfSk7XG59Il19