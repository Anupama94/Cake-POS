e4692abcefcfb8a01991557d5d69d9a9
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        resolve(result);
      } else if (result.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(result);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      } else {
        reject({
          message: _errorConstants.error.UNRECOGNIZED_ERROR.MESSAGE,
          code: _errorConstants.error.UNRECOGNIZED_ERROR.CODE
        });
      }
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        console.log("Unauthorized request initiated from axios post call in callApi.js");
        reject(err);
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios post call in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios post call in callApi.js");
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.get(callingUrl, requestHeader).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.response.status === _httpStatusCodes.default.NOT_FOUND) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios authenticatedGetCall in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios authenticatedGetCall in callApi.js");
        reject(err);
      }
    });
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.put(callingUrl, updateOps)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.put(callingUrl, updateOps).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.NO_CONTENT || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios putCall in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from axios putCall in callApi.js");
        reject(err);
      }
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiVU5SRUNPR05JWkVEX0VSUk9SIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsIk5PVF9GT1VORCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJDUkVBVEVEIiwiVU5FWFBFQ1RFRF9FUlJPUiIsImhlYWRlciIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0IiwicHV0IiwiTk9fQ09OVEVOVCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHLHdCQUFoQjs7QUFFTyxNQUFNQyxTQUFTLEdBQUlDLFdBQUQsSUFBaUI7QUFDdEMsU0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDQyxJQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFnQkosV0FBaEIsQ0FBUixDQUNLSyxJQURMLENBQ1VDLE1BQU0s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QUFDWCxNQUFULEtBQW9CQyx5QkFBVzRDLFVBQXBFLElBQWtGbEMsUUFBUSxDQUFDWCxNQUFULEtBQW9CQyx5QkFBV3FDLE9BQXJILEVBQThIO0FBQzFIM0MsUUFBQUEsT0FBTyxDQUFDZ0IsUUFBRCxDQUFQO0FBQ0g7QUFDSixLQUxELEVBTUNGLEtBTkQsQ0FNT0MsR0FBRyxJQUFJO0FBQ1YsVUFBSUEsR0FBRyxDQUFDQyxRQUFKLENBQWFYLE1BQWIsS0FBd0JDLHlCQUFXa0IscUJBQXZDLEVBQThEO0FBQzFEVyxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxrRUFBWjtBQUNBbkMsUUFBQUEsTUFBTSxDQUFDYyxHQUFELENBQU47QUFDSCxPQUhELE1BSUs7QUFDRG9CLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZakIsc0JBQU15QixnQkFBTixDQUF1QnZCLE9BQXZCLEdBQWlDLDZDQUE3QztBQUNBcEIsUUFBQUEsTUFBTSxDQUFDYyxHQUFELENBQU47QUFDSDtBQUNKLEtBZkQ7QUFnQkgsR0F2Qk0sQ0FBUDtBQXdCSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFwaUNvbmZpZyB9IGZyb20gJy4uL2FwaUNhbGxzL2NvbmZpZyc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgZXJyb3IgfSBmcm9tICcuL2Vycm9yQ29uc3RhbnRzJztcbmltcG9ydCBIdHRwU3RhdHVzIGZyb20gJ2h0dHAtc3RhdHVzLWNvZGVzJztcblxuY29uc3QgYmFzZVVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxL1wiO1xuXG5leHBvcnQgY29uc3QgdXNlckxvZ2luID0gKGNyZWRlbnRpYWxzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcG9zdENhbGwoXCJ1c2Vycy9sb2dpblwiLCBjcmVkZW50aWFscylcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gPSByZXN1bHQuZGF0YS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLnVzZXJJZCA9IHJlc3VsdC5kYXRhLmlkO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuQVVUSF9GQUlMRUQuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLkFVVEhfRkFJTEVELkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0T3JkZXJJdGVtcyA9IChvcmRlcklkKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvXCIgKyBvcmRlcklkKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuTk9UX0ZPVU5EKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuVU5SRUNPR05JWkVEX0VSUk9SLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5VTlJFQ09HTklaRURfRVJST1IuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuXG5leHBvcnQgY29uc3QgdXBkYXRlT3JkZXIgPSAob3JkZXJJZCwgdXBkYXRlT3BzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcHV0Q2FsbChcIm9yZGVycy9cIiArIG9yZGVySWQsIHVwZGF0ZU9wcylcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICB9KTtcbn1cblxuXG4vLyB0aGlzIG5lZWRzIHRvIGJlIGNoYW5nZWRcbmV4cG9ydCBjb25zdCBnZXRVc2Vyc09yZGVycyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhhcGlDb25maWcudXNlcklkKTtcbiAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvYWxsL1wiICsgYXBpQ29uZmlnLnVzZXJJZClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICB9KTtcbn1cblxuXG5leHBvcnQgY29uc3QgZ2V0TWVudUl0ZW1zID0gKCkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwiaXRlbXMvXCIpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgfSk7XG59XG5cblxuLypcbiAgICBQT1NULCBHRVQsIFBVVCBjYWxscyBkZWZpbmVkXG4gKi9cblxuZnVuY3Rpb24gcG9zdENhbGwodXJsLCBteWRhdGEpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgIGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0sgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLkNSRUFURUQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVEKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5hdXRob3JpemVkIHJlcXVlc3QgaW5pdGlhdGVkIGZyb20gYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludGVybmFsIFNlcnZlciBFcnJvciBpbml0aWF0ZWQgZnJvbSBheGlvcyBwb3N0IGNhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5VTkVYUEVDVEVEX0VSUk9SLk1FU1NBR0UgKyBcIiBpbml0aWF0ZWQgZnJvbSAgYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5cbmZ1bmN0aW9uIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKHVybCwgaGVhZGVyKSB7XG4gICAgY29uc3QgcmVxdWVzdEhlYWRlciA9IHsgaGVhZGVyczogeyBcIkF1dGhvcml6YXRpb25cIjogXCJCZWFyZXIgXCIgKyBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiB9IH07XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgIGF4aW9zLmdldChjYWxsaW5nVXJsLCByZXF1ZXN0SGVhZGVyKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0sgfHwgcmVzcG9uc2UucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSW50ZXJuYWwgU2VydmVyIEVycm9yIGluaXRpYXRlZCBmcm9tIGF4aW9zIGF1dGhlbnRpY2F0ZWRHZXRDYWxsIGluIGNhbGxBcGkuanNcIilcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5VTkVYUEVDVEVEX0VSUk9SLk1FU1NBR0UgKyBcIiBpbml0aWF0ZWQgZnJvbSAgYXhpb3MgYXV0aGVudGljYXRlZEdldENhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBwdXRDYWxsKHVybCwgdXBkYXRlT3BzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICAvLyByZXNvbHZlKGF4aW9zLnB1dChjYWxsaW5nVXJsLCB1cGRhdGVPcHMpXG4gICAgICAgIC8vICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAvLyAgICAgfSkpO1xuXG4gICAgICAgIGF4aW9zLnB1dChjYWxsaW5nVXJsLCB1cGRhdGVPcHMpXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0sgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk5PX0NPTlRFTlQgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLkNSRUFURUQpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludGVybmFsIFNlcnZlciBFcnJvciBpbml0aWF0ZWQgZnJvbSBheGlvcyBwdXRDYWxsIGluIGNhbGxBcGkuanNcIilcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLlVORVhQRUNURURfRVJST1IuTUVTU0FHRSArIFwiIGluaXRpYXRlZCBmcm9tIGF4aW9zIHB1dENhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59Il19