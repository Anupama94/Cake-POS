c09da83f8e655dd0b5b5b01dd40e9403
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        console.log("Unauthorized request initiated from axios post call in callApi.js");
        reject(err);
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios post call in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios post call in callApi.js");
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.get(callingUrl, requestHeader)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.get(callingUrl, requestHeader).then(response => {
      if (response.status === _httpStatusCodes.default.OK) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios authenticatedGetCall in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios authenticatedGetCall in callApi.js");
        reject(err);
      }
    });
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJDUkVBVEVEIiwiVU5FWFBFQ1RFRF9FUlJPUiIsImhlYWRlciIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0IiwicHV0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUcsd0JBQWhCOztBQUVPLE1BQU1DLFNBQVMsR0FBSUMsV0FBRCxJQUFpQjtBQUN0QyxTQUFPLElBQUlDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcENDLElBQUFBLFFBQVEsQ0FBQyxhQUFELEVBQWdCSixXQUFoQixDQUFSLENBQ0tLLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1osVUFBSUEsTUFBTSxDQUFDQyxNQUFQLEtBQWtCQyx5QkFBV0Ms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QyxPQUFPLEdBQUd3QyxHQUEzQjtBQUNBcEMsSUFBQUEsT0FBTyxDQUFDdUMsZUFBTVEsR0FBTixDQUFVVCxVQUFWLEVBQXNCUixTQUF0QixFQUNIM0IsSUFERyxDQUNFYSxRQUFRLElBQUk7QUFDZCxhQUFPQSxRQUFQO0FBQ0gsS0FIRyxDQUFELENBQVA7QUFJSCxHQU5NLENBQVA7QUFPSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFwaUNvbmZpZyB9IGZyb20gJy4uL2FwaUNhbGxzL2NvbmZpZyc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgZXJyb3IgfSBmcm9tICcuL2Vycm9yQ29uc3RhbnRzJztcbmltcG9ydCBIdHRwU3RhdHVzIGZyb20gJ2h0dHAtc3RhdHVzLWNvZGVzJztcblxuY29uc3QgYmFzZVVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxL1wiO1xuXG5leHBvcnQgY29uc3QgdXNlckxvZ2luID0gKGNyZWRlbnRpYWxzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcG9zdENhbGwoXCJ1c2Vycy9sb2dpblwiLCBjcmVkZW50aWFscylcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gPSByZXN1bHQuZGF0YS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgYXBpQ29uZmlnLnVzZXJJZCA9IHJlc3VsdC5kYXRhLmlkO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuQVVUSF9GQUlMRUQuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLkFVVEhfRkFJTEVELkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvci5TRVJWSUNFX1VOQVZBSUxBQkxFLkNPREVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IGdldE9yZGVySXRlbXMgPSAob3JkZXJJZCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvXCIgKyBvcmRlcklkKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcblxuXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgZXhwb3J0IGNvbnN0IHVwZGF0ZU9yZGVyID0gKG9yZGVySWQsIHVwZGF0ZU9wcykgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgcHV0Q2FsbChcIm9yZGVycy9cIiArIG9yZGVySWQsIHVwZGF0ZU9wcylcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLy8gdGhpcyBuZWVkcyB0byBiZSBjaGFuZ2VkXG4gICAgZXhwb3J0IGNvbnN0IGdldFVzZXJzT3JkZXJzID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYXBpQ29uZmlnLnVzZXJJZCk7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9hbGwvXCIgKyBhcGlDb25maWcudXNlcklkKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBleHBvcnQgY29uc3QgZ2V0TWVudUl0ZW1zID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJpdGVtcy9cIilcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHsgcmVqZWN0KCkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLypcbiAgICAgICAgUE9TVCwgR0VULCBQVVQgY2FsbHMgZGVmaW5lZFxuICAgICAqL1xuXG4gICAgZnVuY3Rpb24gcG9zdENhbGwodXJsLCBteWRhdGEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSyB8fCByZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuQ1JFQVRFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5hdXRob3JpemVkIHJlcXVlc3QgaW5pdGlhdGVkIGZyb20gYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IgaW5pdGlhdGVkIGZyb20gYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5VTkVYUEVDVEVEX0VSUk9SLk1FU1NBR0UgKyBcIiBpbml0aWF0ZWQgZnJvbSAgYXhpb3MgcG9zdCBjYWxsIGluIGNhbGxBcGkuanNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKHVybCwgaGVhZGVyKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RIZWFkZXIgPSB7IGhlYWRlcnM6IHsgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gfSB9O1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgICAgICAvLyByZXNvbHZlKGF4aW9zLmdldChjYWxsaW5nVXJsLCByZXF1ZXN0SGVhZGVyKVxuICAgICAgICAgICAgLy8gICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgLy8gICAgIH0pKTtcbiAgICAgICAgICAgIGF4aW9zLmdldChjYWxsaW5nVXJsLCByZXF1ZXN0SGVhZGVyKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludGVybmFsIFNlcnZlciBFcnJvciBpbml0aWF0ZWQgZnJvbSBheGlvcyBhdXRoZW50aWNhdGVkR2V0Q2FsbCBpbiBjYWxsQXBpLmpzXCIpXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5VTkVYUEVDVEVEX0VSUk9SLk1FU1NBR0UgKyBcIiBpbml0aWF0ZWQgZnJvbSAgYXhpb3MgYXV0aGVudGljYXRlZEdldENhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHB1dENhbGwodXJsLCB1cGRhdGVPcHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIHJlc29sdmUoYXhpb3MucHV0KGNhbGxpbmdVcmwsIHVwZGF0ZU9wcylcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0iXX0=