79f0e551f4b9b1c064bd0cd1b9c61113
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === _httpStatusCodes.default.OK || response.status === _httpStatusCodes.default.CREATED) {
        resolve(response);
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        console.log("Unauthorized request initiated from axios post call in callApi.js");
        reject(err);
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        console.log("Internal Server Error initiated from axios post call in callApi.js");
        reject(err);
      } else {
        console.log(_errorConstants.error.UNEXPECTED_ERROR.MESSAGE + " initiated from  axios post call in callApi.js");
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.get(callingUrl, requestHeader).then(response => {
      return response;
    }));
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJDUkVBVEVEIiwiVU5FWFBFQ1RFRF9FUlJPUiIsImhlYWRlciIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0IiwicHV0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUcsd0JBQWhCOztBQUVPLE1BQU1DLFNBQVMsR0FBSUMsV0FBRCxJQUFpQjtBQUN0QyxTQUFPLElBQUlDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcENDLElBQUFBLFFBQVEsQ0FBQyxhQUFELEVBQWdCSixXQUFoQixDQUFSLENBQ0tLLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1osVUFBSUEsTUFBTSxDQUFDQyxNQUFQLEtBQWtCQyx5QkFBV0Ms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QUF3Qkg7O0FBR0QsU0FBU2Esb0JBQVQsQ0FBOEJRLEdBQTlCLEVBQW1DTyxNQUFuQyxFQUEyQztBQUN2QyxRQUFNQyxhQUFhLEdBQUc7QUFBRUMsSUFBQUEsT0FBTyxFQUFFO0FBQUUsdUJBQWlCLFlBQVlyQyxrQkFBVUM7QUFBekM7QUFBWCxHQUF0QjtBQUVBLFNBQU8sSUFBSVYsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxRQUFJcUMsVUFBVSxHQUFHMUMsT0FBTyxHQUFHd0MsR0FBM0I7QUFDQXBDLElBQUFBLE9BQU8sQ0FBQ3VDLGVBQU1PLEdBQU4sQ0FBVVIsVUFBVixFQUFzQk0sYUFBdEIsRUFDSHpDLElBREcsQ0FDRWEsUUFBUSxJQUFJO0FBQ2QsYUFBT0EsUUFBUDtBQUNILEtBSEcsQ0FBRCxDQUFQO0FBSUgsR0FOTSxDQUFQO0FBT0g7O0FBR0QsU0FBU2UsT0FBVCxDQUFpQkssR0FBakIsRUFBc0JOLFNBQXRCLEVBQWlDO0FBQzdCLFNBQU8sSUFBSS9CLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcEMsUUFBSXFDLFVBQVUsR0FBRzFDLE9BQU8sR0FBR3dDLEdBQTNCO0FBQ0FwQyxJQUFBQSxPQUFPLENBQUN1QyxlQUFNUSxHQUFOLENBQVVULFVBQVYsRUFBc0JSLFNBQXRCLEVBQ0gzQixJQURHLENBQ0VhLFFBQVEsSUFBSTtBQUNkLGFBQU9BLFFBQVA7QUFDSCxLQUhHLENBQUQsQ0FBUDtBQUlILEdBTk0sQ0FBUDtBQU9IIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBpQ29uZmlnIH0gZnJvbSAnLi4vYXBpQ2FsbHMvY29uZmlnJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBlcnJvciB9IGZyb20gJy4vZXJyb3JDb25zdGFudHMnO1xuaW1wb3J0IEh0dHBTdGF0dXMgZnJvbSAnaHR0cC1zdGF0dXMtY29kZXMnO1xuXG5jb25zdCBiYXNlVXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDEvXCI7XG5cbmV4cG9ydCBjb25zdCB1c2VyTG9naW4gPSAoY3JlZGVudGlhbHMpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBwb3N0Q2FsbChcInVzZXJzL2xvZ2luXCIsIGNyZWRlbnRpYWxzKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiA9IHJlc3VsdC5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcudXNlcklkID0gcmVzdWx0LmRhdGEuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5BVVRIX0ZBSUxFRC5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuQVVUSF9GQUlMRUQuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0T3JkZXJJdGVtcyA9IChvcmRlcklkKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9cIiArIG9yZGVySWQpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuXG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBleHBvcnQgY29uc3QgdXBkYXRlT3JkZXIgPSAob3JkZXJJZCwgdXBkYXRlT3BzKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBwdXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZCwgdXBkYXRlT3BzKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvLyB0aGlzIG5lZWRzIHRvIGJlIGNoYW5nZWRcbiAgICBleHBvcnQgY29uc3QgZ2V0VXNlcnNPcmRlcnMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcGlDb25maWcudXNlcklkKTtcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL2FsbC9cIiArIGFwaUNvbmZpZy51c2VySWQpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBjb25zdCBnZXRNZW51SXRlbXMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIml0ZW1zL1wiKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvKlxuICAgICAgICBQT1NULCBHRVQsIFBVVCBjYWxscyBkZWZpbmVkXG4gICAgICovXG5cbiAgICBmdW5jdGlvbiBwb3N0Q2FsbCh1cmwsIG15ZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICAgICAgYXhpb3MucG9zdChjYWxsaW5nVXJsLCBteWRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLk9LIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5DUkVBVEVEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbmF1dGhvcml6ZWQgcmVxdWVzdCBpbml0aWF0ZWQgZnJvbSBheGlvcyBwb3N0IGNhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkludGVybmFsIFNlcnZlciBFcnJvciBpbml0aWF0ZWQgZnJvbSBheGlvcyBwb3N0IGNhbGwgaW4gY2FsbEFwaS5qc1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLlVORVhQRUNURURfRVJST1IuTUVTU0FHRSArIFwiIGluaXRpYXRlZCBmcm9tICBheGlvcyBwb3N0IGNhbGwgaW4gY2FsbEFwaS5qc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gYXV0aGVudGljYXRlZEdldENhbGwodXJsLCBoZWFkZXIpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdEhlYWRlciA9IHsgaGVhZGVyczogeyBcIkF1dGhvcml6YXRpb25cIjogXCJCZWFyZXIgXCIgKyBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiB9IH07XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIHJlc29sdmUoYXhpb3MuZ2V0KGNhbGxpbmdVcmwsIHJlcXVlc3RIZWFkZXIpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHB1dENhbGwodXJsLCB1cGRhdGVPcHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgICAgIHJlc29sdmUoYXhpb3MucHV0KGNhbGxpbmdVcmwsIHVwZGF0ZU9wcylcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0iXX0=