15d0a8c3d2a232c4ea16a0f36371ae1b
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

const baseUrl = "http://localhost:3001/";

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === _httpStatusCodes.default.OK) {
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      if (err.response.status === _httpStatusCodes.default.UNAUTHORIZED) {
        reject({
          message: _errorConstants.error.AUTH_FAILED.MESSAGE,
          code: _errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === _httpStatusCodes.default.INTERNAL_SERVER_ERROR) {
        reject({
          message: _errorConstants.error.SERVICE_UNAVAILABLE.MESSAGE,
          code: _errorConstants.error.SERVICE_UNAVAILABLE.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.post(callingUrl, mydata)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === 200 || response.status === 201) {
        resolve(response);
      } else if (response.status === 500) {
        console.log("error calling api post call");
        reject();
      } else {
        console.log("unexpected error code");
        reject();
      }
    }).catch(err => {
      if (err.response.status === 401) {
        reject(err);
      } else if (err.response.status === 500) {
        reject(err);
      } else {}
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.get(callingUrl, requestHeader).then(response => {
      return response;
    }));
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJhcGlDb25maWciLCJhdXRoZW50aWNhdGlvblRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiZ2V0T3JkZXJJdGVtcyIsIm9yZGVySWQiLCJhdXRoZW50aWNhdGVkR2V0Q2FsbCIsInVwZGF0ZU9yZGVyIiwidXBkYXRlT3BzIiwicHV0Q2FsbCIsImdldFVzZXJzT3JkZXJzIiwiY29uc29sZSIsImxvZyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJoZWFkZXIiLCJyZXF1ZXN0SGVhZGVyIiwiaGVhZGVycyIsImdldCIsInB1dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHLHdCQUFoQjs7QUFFTyxNQUFNQyxTQUFTLEdBQUlDLFdBQUQsSUFBaUI7QUFDdEMsU0FBTyxJQUFJQyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDQyxJQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFnQkosV0FBaEIsQ0FBUixDQUNLSyxJQURMLENBQ1VDLE1BQU0sSUFBSTtBQUNaLFVBQUlBLE1BQU0sQ0FBQ0MsTUFBUCxLQUFrQkMseUJBQVdDLEVBQWpDLEVBQXFDO0FBQ2pDQywwQkFBVUMsbUJBQVYsR0FBZ0NMLE1BQU0sQ0FBQ00sSUFBUCxDQUFZQyxLQUE1QztBQUNBSCwwQkFBVUksTUFBVixHQUFtQlIsTUFBTSxDQUFDTSxJQUFQLENBQVlHLEVBQS9CO0FBQ0FiLFFBQUFBLE9BQU87QUFDVjtBQUNKLEtBUEwsRUFRS2MsS0FSTCxDQVFXQyxHQUFHLElBQUk7QUFDVixVQUFJQSxHQUFHLENBQUNDLFFBQUosQ0FBYVgsTUFBYixLQUF3QkMseUJBQVdXLFlBQXZDLEVBQXFEO0FBQ2pEaEIsUUFBQUEsTUFBTSxDQUFDO0FBQ0hpQixVQUFBQSxPQUFPLEVBQUVDLHNCQUFNQyxXQUFOLENBQWtCQyxPQUR4QjtBQUVIQyxVQUFBQSxJQUFJLEVBQUVILHNCQUFNQyxXQUFOLENBQWtCRztBQUZyQixTQUFELENBQU47QUFJSCxPQUxELE1BTUssSUFBSVIsR0FBRyxDQUFDQyxRQUFKLENBQWFYLE1BQWIsS0FBd0JDLHlCQUFXa0IscUJBQXZDLEVBQThEO0FBQy9EdkIsUUFBQUEsTUFBTSxDQUFDO0FBQ0hpQixVQUFBQSxPQUFPLEVBQUVDLHNCQUFNTSxtQkFBTixDQUEwQkosT0FEaEM7QUFFSEMsVUFBQUEsSUFBSSxFQUFFSCxzQkFBTU0sbUJBQU4sQ0FBMEJGO0FBRjdCLFNBQUQsQ0FBTjtBQUlIO0FBRUosS0F0Qkw7QUF1QkgsR0F4Qk0sQ0FBUDtBQXlCSCxDQTFCTTs7OztBQTRCQSxNQUFNRyxhQUFhLEdBQUlDLE9BQUQsSUFBYTtBQUNsQyxTQUFPLElBQUk1QixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDMkIsSUFBQUEsb0JBQW9CLENBQUMsWUFBWUQsT0FBYixDQUFwQixDQUNLeEIsSUFETCxDQUNVQyxNQUFNLElBQUk7QUFDWkosTUFBQUEsT0FBTyxDQUFDSSxNQUFELENBQVA7QUFHSCxLQUxMLEVBTUtVLEtBTkwsQ0FNV0MsR0FBRyxJQUFJO0FBQUVkLE1BQUFBLE1BQU07QUFBSSxLQU45QjtBQU9ILEdBUk0sQ0FBUDtBQVNILENBVkU7Ozs7QUFhSSxNQUFNNEIsV0FBVyxHQUFHLENBQUNGLE9BQUQsRUFBVUcsU0FBVixLQUF3QjtBQUMvQyxTQUFPLElBQUkvQixPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDOEIsSUFBQUEsT0FBTyxDQUFDLFlBQVlKLE9BQWIsRUFBc0JHLFNBQXRCLENBQVAsQ0FDSzNCLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1pKLE1BQUFBLE9BQU8sQ0FBQ0ksTUFBRCxDQUFQO0FBQ0gsS0FITCxFQUlLVSxLQUpMLENBSVdDLEdBQUcsSUFBSTtBQUFFZCxNQUFBQSxNQUFNO0FBQUksS0FKOUI7QUFLSCxHQU5NLENBQVA7QUFPSCxDQVJNLEMsQ0FXUDs7Ozs7QUFDTyxNQUFNK0IsY0FBYyxHQUFHLE1BQU07QUFDaEMsU0FBTyxJQUFJakMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQ2dDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZMUIsa0JBQVVJLE1BQXRCO0FBQ0FnQixJQUFBQSxvQkFBb0IsQ0FBQyxnQkFBZ0JwQixrQkFBVUksTUFBM0IsQ0FBcEIsQ0FDS1QsSUFETCxDQUNVQyxNQUFNLElBQUk7QUFDWkosTUFBQUEsT0FBTyxDQUFDSSxNQUFELENBQVA7QUFDSCxLQUhMLEVBSUtVLEtBSkwsQ0FJV0MsR0FBRyxJQUFJO0FBQUVkLE1BQUFBLE1BQU07QUFBSSxLQUo5QjtBQUtILEdBUE0sQ0FBUDtBQVFILENBVE07Ozs7QUFZQSxNQUFNa0MsWUFBWSxHQUFHLE1BQU07QUFDOUIsU0FBTyxJQUFJcEMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQzJCLElBQUFBLG9CQUFvQixDQUFDLFFBQUQsQ0FBcEIsQ0FDS3pCLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1pKLE1BQUFBLE9BQU8sQ0FBQ0ksTUFBRCxDQUFQO0FBQ0gsS0FITCxFQUlLVSxLQUpMLENBSVdDLEdBQUcsSUFBSTtBQUFFZCxNQUFBQSxNQUFNO0FBQUksS0FKOUI7QUFLSCxHQU5NLENBQVA7QUFPSCxDQVJNO0FBV1A7Ozs7Ozs7QUFJQSxTQUFTQyxRQUFULENBQWtCa0MsR0FBbEIsRUFBdUJDLE1BQXZCLEVBQStCO0FBQzNCLFNBQU8sSUFBSXRDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcEMsUUFBSXFDLFVBQVUsR0FBRzFDLE9BQU8sR0FBR3dDLEdBQTNCLENBRG9DLENBRXBDO0FBQ0E7QUFDQTtBQUNBOztBQUNBRyxtQkFBTUMsSUFBTixDQUFXRixVQUFYLEVBQXVCRCxNQUF2QixFQUNLbEMsSUFETCxDQUNVYSxRQUFRLElBQUk7QUFDZCxVQUFJQSxRQUFRLENBQUNYLE1BQVQsS0FBb0IsR0FBcEIsSUFBMkJXLFFBQVEsQ0FBQ1gsTUFBVCxLQUFvQixHQUFuRCxFQUF3RDtBQUVwREwsUUFBQUEsT0FBTyxDQUFDZ0IsUUFBRCxDQUFQO0FBQ0gsT0FIRCxNQUlLLElBQUlBLFFBQVEsQ0FBQ1gsTUFBVCxLQUFvQixHQUF4QixFQUE2QjtBQUM5QjRCLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLDZCQUFaO0FBQ0FqQyxRQUFBQSxNQUFNO0FBQ1QsT0FISSxNQUlBO0FBQ0RnQyxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSx1QkFBWjtBQUNBakMsUUFBQUEsTUFBTTtBQUNUO0FBQ0osS0FkTCxFQWdCS2EsS0FoQkwsQ0FnQldDLEdBQUcsSUFBSTtBQUNWLFVBQUlBLEdBQUcsQ0FBQ0MsUUFBSixDQUFhWCxNQUFiLEtBQXdCLEdBQTVCLEVBQWlDO0FBQzdCSixRQUFBQSxNQUFNLENBQUNjLEdBQUQsQ0FBTjtBQUNILE9BRkQsTUFHSyxJQUFJQSxHQUFHLENBQUNDLFFBQUosQ0FBYVgsTUFBYixLQUF3QixHQUE1QixFQUFpQztBQUNsQ0osUUFBQUEsTUFBTSxDQUFDYyxHQUFELENBQU47QUFDSCxPQUZJLE1BR0EsQ0FFSjtBQUNKLEtBMUJMO0FBMkJILEdBakNNLENBQVA7QUFrQ0g7O0FBR0QsU0FBU2Esb0JBQVQsQ0FBOEJRLEdBQTlCLEVBQW1DSyxNQUFuQyxFQUEyQztBQUN2QyxRQUFNQyxhQUFhLEdBQUc7QUFBRUMsSUFBQUEsT0FBTyxFQUFFO0FBQUUsdUJBQWlCLFlBQVluQyxrQkFBVUM7QUFBekM7QUFBWCxHQUF0QjtBQUVBLFNBQU8sSUFBSVYsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxRQUFJcUMsVUFBVSxHQUFHMUMsT0FBTyxHQUFHd0MsR0FBM0I7QUFDQXBDLElBQUFBLE9BQU8sQ0FBQ3VDLGVBQU1LLEdBQU4sQ0FBVU4sVUFBVixFQUFzQkksYUFBdEIsRUFDSHZDLElBREcsQ0FDRWEsUUFBUSxJQUFJO0FBQ2QsYUFBT0EsUUFBUDtBQUNILEtBSEcsQ0FBRCxDQUFQO0FBSUgsR0FOTSxDQUFQO0FBT0g7O0FBR0QsU0FBU2UsT0FBVCxDQUFpQkssR0FBakIsRUFBc0JOLFNBQXRCLEVBQWlDO0FBQzdCLFNBQU8sSUFBSS9CLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcEMsUUFBSXFDLFVBQVUsR0FBRzFDLE9BQU8sR0FBR3dDLEdBQTNCO0FBQ0FwQyxJQUFBQSxPQUFPLENBQUN1QyxlQUFNTSxHQUFOLENBQVVQLFVBQVYsRUFBc0JSLFNBQXRCLEVBQ0gzQixJQURHLENBQ0VhLFFBQVEsSUFBSTtBQUNkLGFBQU9BLFFBQVA7QUFDSCxLQUhHLENBQUQsQ0FBUDtBQUlILEdBTk0sQ0FBUDtBQU9IIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBpQ29uZmlnIH0gZnJvbSAnLi4vYXBpQ2FsbHMvY29uZmlnJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBlcnJvciB9IGZyb20gJy4vZXJyb3JDb25zdGFudHMnO1xuaW1wb3J0IEh0dHBTdGF0dXMgZnJvbSAnaHR0cC1zdGF0dXMtY29kZXMnO1xuXG5jb25zdCBiYXNlVXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDEvXCI7XG5cbmV4cG9ydCBjb25zdCB1c2VyTG9naW4gPSAoY3JlZGVudGlhbHMpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBwb3N0Q2FsbChcInVzZXJzL2xvZ2luXCIsIGNyZWRlbnRpYWxzKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiA9IHJlc3VsdC5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcudXNlcklkID0gcmVzdWx0LmRhdGEuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVEKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5BVVRIX0ZBSUxFRC5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3IuQVVUSF9GQUlMRUQuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuTUVTU0FHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLlNFUlZJQ0VfVU5BVkFJTEFCTEUuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0T3JkZXJJdGVtcyA9IChvcmRlcklkKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIm9yZGVycy9cIiArIG9yZGVySWQpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuXG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBleHBvcnQgY29uc3QgdXBkYXRlT3JkZXIgPSAob3JkZXJJZCwgdXBkYXRlT3BzKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBwdXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZCwgdXBkYXRlT3BzKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvLyB0aGlzIG5lZWRzIHRvIGJlIGNoYW5nZWRcbiAgICBleHBvcnQgY29uc3QgZ2V0VXNlcnNPcmRlcnMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcGlDb25maWcudXNlcklkKTtcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKFwib3JkZXJzL2FsbC9cIiArIGFwaUNvbmZpZy51c2VySWQpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7IHJlamVjdCgpIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBjb25zdCBnZXRNZW51SXRlbXMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIml0ZW1zL1wiKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4geyByZWplY3QoKSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvKlxuICAgICAgICBQT1NULCBHRVQsIFBVVCBjYWxscyBkZWZpbmVkXG4gICAgICovXG5cbiAgICBmdW5jdGlvbiBwb3N0Q2FsbCh1cmwsIG15ZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGNhbGxpbmdVcmwgPSBiYXNlVXJsICsgdXJsO1xuICAgICAgICAgICAgLy8gcmVzb2x2ZShheGlvcy5wb3N0KGNhbGxpbmdVcmwsIG15ZGF0YSlcbiAgICAgICAgICAgIC8vICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIC8vICAgICB9KSk7XG4gICAgICAgICAgICBheGlvcy5wb3N0KGNhbGxpbmdVcmwsIG15ZGF0YSlcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDIwMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDUwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBjYWxsaW5nIGFwaSBwb3N0IGNhbGxcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidW5leHBlY3RlZCBlcnJvciBjb2RlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSA1MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZWRHZXRDYWxsKHVybCwgaGVhZGVyKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RIZWFkZXIgPSB7IGhlYWRlcnM6IHsgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgYXBpQ29uZmlnLmF1dGhlbnRpY2F0aW9uVG9rZW4gfSB9O1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgICAgICByZXNvbHZlKGF4aW9zLmdldChjYWxsaW5nVXJsLCByZXF1ZXN0SGVhZGVyKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBwdXRDYWxsKHVybCwgdXBkYXRlT3BzKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2FsbGluZ1VybCA9IGJhc2VVcmwgKyB1cmw7XG4gICAgICAgICAgICByZXNvbHZlKGF4aW9zLnB1dChjYWxsaW5nVXJsLCB1cGRhdGVPcHMpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9Il19