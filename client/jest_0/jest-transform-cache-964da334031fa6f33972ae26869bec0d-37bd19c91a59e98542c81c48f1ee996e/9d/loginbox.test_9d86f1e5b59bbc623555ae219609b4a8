f9f5eebad08e80282b6cdcfd9f08dc1c
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _enzyme = require("enzyme");

var _LoginBox = require("../Login/LoginBox");

var _enzymeToJson = require("enzyme-to-json");

var _errorConstants = require("../../apiCalls/errorConstants");

var _httpStatusCodes = _interopRequireDefault(require("http-status-codes"));

var _jsxFileName = "/home/anupamaa/Desktop/Training/pos/server/client/src/components/tests/loginbox.test.js";
describe("LoginBox Component", () => {
  let wrapper;
  let initialState = {
    email: '',
    password: '',
    validate: {
      emailState: '',
      passwordState: ''
    },
    errorAlert: {
      visible: false,
      message: ''
    }
  };
  beforeEach(() => {
    wrapper = (0, _enzyme.shallow)(_react.default.createElement(_LoginBox.LoginBox, {
      __source: {
        fileName: _jsxFileName,
        lineNumber: 26
      },
      __self: void 0
    }));
  });
  it("should render correctly", () => {
    expect((0, _enzymeToJson.shallowToJson)(wrapper)).toMatchSnapshot();
  });
  it('when submit button is clicked without username nor password emailState should be set to has-danger', () => {
    const logInSpy = jest.spyOn(wrapper.instance(), "submitLogin");
    wrapper.instance().forceUpdate();
    expect(logInSpy).not.toHaveBeenCalled();
    wrapper.find('button.login-btn').simulate('click');
    expect(logInSpy).toHaveBeenCalledTimes(1);
    expect(wrapper.state().validate.emailState).toBe("has-danger");
  });
  it('when submit button is clicked with username but no password password-state should be set to has-danger', () => {
    const logInSpy = jest.spyOn(wrapper.instance(), "submitLogin");
    wrapper.setState({
      validate: {
        emailState: 'has-success'
      }
    });
    wrapper.instance().forceUpdate();
    expect(logInSpy).not.toHaveBeenCalled();
    wrapper.find('button.login-btn').simulate('click');
    expect(logInSpy).toHaveBeenCalledTimes(1);
    expect(wrapper.state().validate.passwordState).toBe("has-danger");
  });
  it('when submit button is clicked with password but no username email-state should be set to has-danger', () => {
    const logInSpy = jest.spyOn(wrapper.instance(), "submitLogin");
    wrapper.setState({
      validate: {
        passwordState: 'has-success'
      }
    });
    wrapper.instance().forceUpdate();
    expect(logInSpy).not.toHaveBeenCalled();
    wrapper.find('button.login-btn').simulate('click');
    expect(logInSpy).toHaveBeenCalledTimes(1);
    expect(wrapper.state().validate.emailState).toBe("has-danger");
  });
  it('when submit button is clicked with invalid username and password authentication should be failed and alert should be displayed', () => {
    const logInSpy = jest.spyOn(wrapper.instance(), "submitLogin"); //jest.unmock('../../apiCalls/callApi');

    const apiCall = require('../../apiCalls/callApi');

    apiCall.userLogin = jest.fn(() => Promise.reject({
      message: _errorConstants.error.AUTH_FAILED.MESSAGE,
      code: _errorConstants.error.AUTH_FAILED.CODE
    }));
    wrapper.setState({
      validate: {
        emailState: 'has-success',
        passwordState: 'has-success'
      }
    });
    wrapper.instance().forceUpdate();
    expect(logInSpy).not.toHaveBeenCalled();
    wrapper.find('button.login-btn').simulate('click');
    expect(logInSpy).toHaveBeenCalledTimes(1);
    expect(apiCall.userLogin).toHaveBeenCalledTimes(1);
    apiCall.userLogin({
      email: "abcd@123.com",
      password: "invalidPassword"
    }).catch(err => {
      expect(err.message).toBe(_errorConstants.error.AUTH_FAILED.MESSAGE);
      expect(err.code).toBe(_errorConstants.error.AUTH_FAILED.CODE);
      expect(wrapper.state().errorAlert.visible).toBe(true);
      expect(wrapper.state().errorAlert.message).toBe(_errorConstants.error.AUTH_FAILED.MESSAGE);
    }); //expect(wrapper.state().errorAlert.visible).toBe(true);
  });
  it('when submit button is clicked with valid username and password, should be routed to the orderlist', () => {
    jest.unmock('../../apiCalls/callApi');
    const logInSpy = jest.spyOn(wrapper.instance(), "submitLogin");

    const apiCall = require('../../apiCalls/callApi');

    apiCall.userLogin = jest.fn(() => Promise.resolve({
      status: _httpStatusCodes.default.OK
    }));
    wrapper.setState({
      validate: {
        emailState: 'has-success',
        passwordState: 'has-success'
      }
    });
    wrapper.instance().forceUpdate();
    expect(logInSpy).not.toHaveBeenCalled();
    wrapper.find('button.login-btn').simulate('click');
    expect(logInSpy).toHaveBeenCalledTimes(1);
    expect(apiCall.userLogin).toHaveBeenCalledTimes(1);
    apiCall.userLogin({
      email: "abcd@123.com",
      password: "abc"
    }).then(response => {
      expect(response.status).toBe(_httpStatusCodes.default.OK);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luYm94LnRlc3QuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJ3cmFwcGVyIiwiaW5pdGlhbFN0YXRlIiwiZW1haWwiLCJwYXNzd29yZCIsInZhbGlkYXRlIiwiZW1haWxTdGF0ZSIsInBhc3N3b3JkU3RhdGUiLCJlcnJvckFsZXJ0IiwidmlzaWJsZSIsIm1lc3NhZ2UiLCJiZWZvcmVFYWNoIiwiaXQiLCJleHBlY3QiLCJ0b01hdGNoU25hcHNob3QiLCJsb2dJblNweSIsImplc3QiLCJzcHlPbiIsImluc3RhbmNlIiwiZm9yY2VVcGRhdGUiLCJub3QiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwiZmluZCIsInNpbXVsYXRlIiwidG9IYXZlQmVlbkNhbGxlZFRpbWVzIiwic3RhdGUiLCJ0b0JlIiwic2V0U3RhdGUiLCJhcGlDYWxsIiwicmVxdWlyZSIsInVzZXJMb2dpbiIsImZuIiwiUHJvbWlzZSIsInJlamVjdCIsImVycm9yIiwiQVVUSF9GQUlMRUQiLCJNRVNTQUdFIiwiY29kZSIsIkNPREUiLCJjYXRjaCIsImVyciIsInVubW9jayIsInJlc29sdmUiLCJzdGF0dXMiLCJIdHRwU3RhdHVzIiwiT0siLCJ0aGVuIiwicmVzcG9uc2UiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7O0FBRUFBLFFBQVEsQ0FBQyxvQkFBRCxFQUF1QixNQUFNO0FBRW5DLE1BQUlDLE9BQUo7QUFDQSxNQUFJQyxZQUFZLEdBQUc7QUFDakJDLElBQUFBLEtBQUssRUFBRSxFQURVO0FBRWpCQyxJQUFBQSxRQUFRLEVBQUUsRUFGTztBQUdqQkMsSUFBQUEsUUFBUSxFQUFFO0FBQ1JDLE1BQUFBLFVBQVUsRUFBRSxFQURKO0FBRVJDLE1BQUFBLGFBQWEsRUFBRTtBQUZQLEtBSE87QUFPakJDLElBQUFBLFVBQVUsRUFBRTtBQUNWQyxNQUFBQSxPQUFPLEVBQUUsS0FEQztBQUVWQyxNQUFBQSxPQUFPLEVBQUU7QUFGQztBQVBL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QUEsUUFBUSxFQUFFO0FBQUVDLFFBQUFBLFVBQVUsRUFBRSxhQUFkO0FBQTZCQyxRQUFBQSxhQUFhLEVBQUU7QUFBNUM7QUFBWixLQUFqQjtBQUNBTixJQUFBQSxPQUFPLENBQUNpQixRQUFSLEdBQW1CQyxXQUFuQjtBQUNBTixJQUFBQSxNQUFNLENBQUNFLFFBQUQsQ0FBTixDQUFpQkssR0FBakIsQ0FBcUJDLGdCQUFyQjtBQUNBcEIsSUFBQUEsT0FBTyxDQUFDcUIsSUFBUixDQUFhLGtCQUFiLEVBQWlDQyxRQUFqQyxDQUEwQyxPQUExQztBQUNBVixJQUFBQSxNQUFNLENBQUNFLFFBQUQsQ0FBTixDQUFpQlMscUJBQWpCLENBQXVDLENBQXZDO0FBQ0FYLElBQUFBLE1BQU0sQ0FBQ2UsT0FBTyxDQUFDRSxTQUFULENBQU4sQ0FBMEJOLHFCQUExQixDQUFnRCxDQUFoRDtBQUNBSSxJQUFBQSxPQUFPLENBQUNFLFNBQVIsQ0FBa0I7QUFBRTNCLE1BQUFBLEtBQUssRUFBRSxjQUFUO0FBQXlCQyxNQUFBQSxRQUFRLEVBQUU7QUFBbkMsS0FBbEIsRUFDRzBDLElBREgsQ0FDUUMsUUFBUSxJQUFJO0FBQ2hCbEMsTUFBQUEsTUFBTSxDQUFDa0MsUUFBUSxDQUFDSixNQUFWLENBQU4sQ0FBd0JqQixJQUF4QixDQUE2QmtCLHlCQUFXQyxFQUF4QztBQUNELEtBSEg7QUFJRCxHQWpCQyxDQUFGO0FBc0JELENBcEhPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgeyBzaGFsbG93IH0gZnJvbSAnZW56eW1lJztcbmltcG9ydCB7IExvZ2luQm94IH0gZnJvbSAnLi4vTG9naW4vTG9naW5Cb3gnXG5pbXBvcnQgeyBzaGFsbG93VG9Kc29uIH0gZnJvbSAnZW56eW1lLXRvLWpzb24nO1xuaW1wb3J0IHsgZXJyb3IgfSBmcm9tICcuLi8uLi9hcGlDYWxscy9lcnJvckNvbnN0YW50cyc7XG5pbXBvcnQgSHR0cFN0YXR1cyBmcm9tICdodHRwLXN0YXR1cy1jb2Rlcyc7XG5cbmRlc2NyaWJlKFwiTG9naW5Cb3ggQ29tcG9uZW50XCIsICgpID0+IHtcblxuICBsZXQgd3JhcHBlcjtcbiAgbGV0IGluaXRpYWxTdGF0ZSA9IHtcbiAgICBlbWFpbDogJycsXG4gICAgcGFzc3dvcmQ6ICcnLFxuICAgIHZhbGlkYXRlOiB7XG4gICAgICBlbWFpbFN0YXRlOiAnJyxcbiAgICAgIHBhc3N3b3JkU3RhdGU6ICcnXG4gICAgfSxcbiAgICBlcnJvckFsZXJ0OiB7XG4gICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICcnXG4gICAgfVxuICB9O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdyYXBwZXIgPSBzaGFsbG93KDxMb2dpbkJveCAvPik7XG4gIH1cbiAgKTtcblxuICBpdChcInNob3VsZCByZW5kZXIgY29ycmVjdGx5XCIsICgpID0+IHtcbiAgICBleHBlY3Qoc2hhbGxvd1RvSnNvbih3cmFwcGVyKSkudG9NYXRjaFNuYXBzaG90KCk7XG4gIH0pO1xuXG5cbiAgaXQoJ3doZW4gc3VibWl0IGJ1dHRvbiBpcyBjbGlja2VkIHdpdGhvdXQgdXNlcm5hbWUgbm9yIHBhc3N3b3JkIGVtYWlsU3RhdGUgc2hvdWxkIGJlIHNldCB0byBoYXMtZGFuZ2VyJywgKCkgPT4ge1xuICAgIGNvbnN0IGxvZ0luU3B5ID0gamVzdC5zcHlPbih3cmFwcGVyLmluc3RhbmNlKCksIFwic3VibWl0TG9naW5cIik7XG5cbiAgICB3cmFwcGVyLmluc3RhbmNlKCkuZm9yY2VVcGRhdGUoKTtcbiAgICBleHBlY3QobG9nSW5TcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgd3JhcHBlci5maW5kKCdidXR0b24ubG9naW4tYnRuJykuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgZXhwZWN0KGxvZ0luU3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS52YWxpZGF0ZS5lbWFpbFN0YXRlKS50b0JlKFwiaGFzLWRhbmdlclwiKTtcblxuXG4gIH0pO1xuXG4gIGl0KCd3aGVuIHN1Ym1pdCBidXR0b24gaXMgY2xpY2tlZCB3aXRoIHVzZXJuYW1lIGJ1dCBubyBwYXNzd29yZCBwYXNzd29yZC1zdGF0ZSBzaG91bGQgYmUgc2V0IHRvIGhhcy1kYW5nZXInLCAoKSA9PiB7XG4gICAgY29uc3QgbG9nSW5TcHkgPSBqZXN0LnNweU9uKHdyYXBwZXIuaW5zdGFuY2UoKSwgXCJzdWJtaXRMb2dpblwiKTtcbiAgICB3cmFwcGVyLnNldFN0YXRlKHsgdmFsaWRhdGU6IHsgZW1haWxTdGF0ZTogJ2hhcy1zdWNjZXNzJyB9IH0pO1xuICAgIHdyYXBwZXIuaW5zdGFuY2UoKS5mb3JjZVVwZGF0ZSgpO1xuICAgIGV4cGVjdChsb2dJblNweSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB3cmFwcGVyLmZpbmQoJ2J1dHRvbi5sb2dpbi1idG4nKS5zaW11bGF0ZSgnY2xpY2snKTtcbiAgICBleHBlY3QobG9nSW5TcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3Qod3JhcHBlci5zdGF0ZSgpLnZhbGlkYXRlLnBhc3N3b3JkU3RhdGUpLnRvQmUoXCJoYXMtZGFuZ2VyXCIpO1xuXG5cbiAgfSk7XG5cblxuICBpdCgnd2hlbiBzdWJtaXQgYnV0dG9uIGlzIGNsaWNrZWQgd2l0aCBwYXNzd29yZCBidXQgbm8gdXNlcm5hbWUgZW1haWwtc3RhdGUgc2hvdWxkIGJlIHNldCB0byBoYXMtZGFuZ2VyJywgKCkgPT4ge1xuICAgIGNvbnN0IGxvZ0luU3B5ID0gamVzdC5zcHlPbih3cmFwcGVyLmluc3RhbmNlKCksIFwic3VibWl0TG9naW5cIik7XG4gICAgd3JhcHBlci5zZXRTdGF0ZSh7IHZhbGlkYXRlOiB7IHBhc3N3b3JkU3RhdGU6ICdoYXMtc3VjY2VzcycgfSB9KTtcbiAgICB3cmFwcGVyLmluc3RhbmNlKCkuZm9yY2VVcGRhdGUoKTtcbiAgICBleHBlY3QobG9nSW5TcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgd3JhcHBlci5maW5kKCdidXR0b24ubG9naW4tYnRuJykuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgZXhwZWN0KGxvZ0luU3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS52YWxpZGF0ZS5lbWFpbFN0YXRlKS50b0JlKFwiaGFzLWRhbmdlclwiKTtcblxuXG4gIH0pO1xuXG5cbiAgaXQoJ3doZW4gc3VibWl0IGJ1dHRvbiBpcyBjbGlja2VkIHdpdGggaW52YWxpZCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgYXV0aGVudGljYXRpb24gc2hvdWxkIGJlIGZhaWxlZCBhbmQgYWxlcnQgc2hvdWxkIGJlIGRpc3BsYXllZCcsICgpID0+IHtcbiAgICBjb25zdCBsb2dJblNweSA9IGplc3Quc3B5T24od3JhcHBlci5pbnN0YW5jZSgpLCBcInN1Ym1pdExvZ2luXCIpO1xuICAgIC8vamVzdC51bm1vY2soJy4uLy4uL2FwaUNhbGxzL2NhbGxBcGknKTtcblxuICAgIGNvbnN0IGFwaUNhbGwgPSByZXF1aXJlKCcuLi8uLi9hcGlDYWxscy9jYWxsQXBpJyk7XG4gICAgYXBpQ2FsbC51c2VyTG9naW4gPSBqZXN0LmZuKCgpID0+IFByb21pc2UucmVqZWN0KHtcbiAgICAgIG1lc3NhZ2U6IGVycm9yLkFVVEhfRkFJTEVELk1FU1NBR0UsXG4gICAgICBjb2RlOiBlcnJvci5BVVRIX0ZBSUxFRC5DT0RFXG4gICAgfSkpO1xuXG5cbiAgICB3cmFwcGVyLnNldFN0YXRlKHsgdmFsaWRhdGU6IHsgZW1haWxTdGF0ZTogJ2hhcy1zdWNjZXNzJywgcGFzc3dvcmRTdGF0ZTogJ2hhcy1zdWNjZXNzJyB9IH0pO1xuICAgIHdyYXBwZXIuaW5zdGFuY2UoKS5mb3JjZVVwZGF0ZSgpO1xuICAgIGV4cGVjdChsb2dJblNweSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB3cmFwcGVyLmZpbmQoJ2J1dHRvbi5sb2dpbi1idG4nKS5zaW11bGF0ZSgnY2xpY2snKTtcbiAgICBleHBlY3QobG9nSW5TcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QoYXBpQ2FsbC51c2VyTG9naW4pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBhcGlDYWxsLnVzZXJMb2dpbih7IGVtYWlsOiBcImFiY2RAMTIzLmNvbVwiLCBwYXNzd29yZDogXCJpbnZhbGlkUGFzc3dvcmRcIiB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGV4cGVjdChlcnIubWVzc2FnZSkudG9CZShlcnJvci5BVVRIX0ZBSUxFRC5NRVNTQUdFKTtcbiAgICAgICAgZXhwZWN0KGVyci5jb2RlKS50b0JlKGVycm9yLkFVVEhfRkFJTEVELkNPREUpO1xuICAgICAgICBleHBlY3Qod3JhcHBlci5zdGF0ZSgpLmVycm9yQWxlcnQudmlzaWJsZSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS5lcnJvckFsZXJ0Lm1lc3NhZ2UpLnRvQmUoZXJyb3IuQVVUSF9GQUlMRUQuTUVTU0FHRSk7XG5cbiAgICAgIH0pO1xuICAgIC8vZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS5lcnJvckFsZXJ0LnZpc2libGUpLnRvQmUodHJ1ZSk7XG5cbiAgfSk7XG5cblxuICBpdCgnd2hlbiBzdWJtaXQgYnV0dG9uIGlzIGNsaWNrZWQgd2l0aCB2YWxpZCB1c2VybmFtZSBhbmQgcGFzc3dvcmQsIHNob3VsZCBiZSByb3V0ZWQgdG8gdGhlIG9yZGVybGlzdCcsICgpID0+IHtcbiAgICBjb25zdCBsb2dJblNweSA9IGplc3Quc3B5T24od3JhcHBlci5pbnN0YW5jZSgpLCBcInN1Ym1pdExvZ2luXCIpO1xuICAgIGplc3QudW5tb2NrKCcuLi8uLi9hcGlDYWxscy9jYWxsQXBpJyk7XG5cbiAgICBjb25zdCBhcGlDYWxsID0gcmVxdWlyZSgnLi4vLi4vYXBpQ2FsbHMvY2FsbEFwaScpO1xuICAgIGFwaUNhbGwudXNlckxvZ2luID0gamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBzdGF0dXM6IEh0dHBTdGF0dXMuT0sgfSkpO1xuXG4gICAgd3JhcHBlci5zZXRTdGF0ZSh7IHZhbGlkYXRlOiB7IGVtYWlsU3RhdGU6ICdoYXMtc3VjY2VzcycsIHBhc3N3b3JkU3RhdGU6ICdoYXMtc3VjY2VzcycgfSB9KTtcbiAgICB3cmFwcGVyLmluc3RhbmNlKCkuZm9yY2VVcGRhdGUoKTtcbiAgICBleHBlY3QobG9nSW5TcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgd3JhcHBlci5maW5kKCdidXR0b24ubG9naW4tYnRuJykuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgZXhwZWN0KGxvZ0luU3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KGFwaUNhbGwudXNlckxvZ2luKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgYXBpQ2FsbC51c2VyTG9naW4oeyBlbWFpbDogXCJhYmNkQDEyMy5jb21cIiwgcGFzc3dvcmQ6IFwiYWJjXCIgfSlcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIdHRwU3RhdHVzLk9LKTtcbiAgICAgIH0pO1xuICB9KTtcblxuXG5cblxufSk7XG4iXX0=