c11d0116c569578a9e7ff0f044e3864f
"use strict";

var _interopRequireDefault = require("/home/anupamaa/Desktop/Training/pos/server/client/node_modules/@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMenuItems = exports.getUsersOrders = exports.updateOrder = exports.getOrderItems = exports.userLogin = void 0;

var _config = require("../apiCalls/config");

var _axios = _interopRequireDefault(require("axios"));

var _errorConstants = require("./errorConstants");

const baseUrl = "http://localhost:3001/";
const requestHeader = {
  headers: {
    "Authorization": "Bearer " + _config.apiConfig.authenticationToken
  }
};

const userLogin = credentials => {
  return new Promise((resolve, reject) => {
    postCall("users/login", credentials).then(result => {
      if (result.status === 200) {
        console.log(result);
        _config.apiConfig.authenticationToken = result.data.token;
        _config.apiConfig.userId = result.data.id;
        resolve();
      }
    }).catch(err => {
      console.log("rejected");

      if (err.response.status === 401) {
        reject({
          message: errorConstants.error.AUTH_FAILED.MESSAGE,
          code: errorConstants.error.AUTH_FAILED.CODE
        });
      } else if (err.response.status === 500) {
        reject({
          message: errorConstants.AUTH_FAILED.MESSAGE,
          code: errorConstants.AUTH_FAILED.CODE
        });
      }
    });
  });
};

exports.userLogin = userLogin;

const getOrderItems = orderId => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("orders/" + orderId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getOrderItems = getOrderItems;

const updateOrder = (orderId, updateOps) => {
  return new Promise((resolve, reject) => {
    putCall("orders/" + orderId, updateOps).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
}; // this needs to be changed


exports.updateOrder = updateOrder;

const getUsersOrders = () => {
  return new Promise((resolve, reject) => {
    console.log(_config.apiConfig.userId);
    authenticatedGetCall("orders/all/" + _config.apiConfig.userId).then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};

exports.getUsersOrders = getUsersOrders;

const getMenuItems = () => {
  return new Promise((resolve, reject) => {
    authenticatedGetCall("items/").then(result => {
      resolve(result);
    }).catch(err => {
      reject();
    });
  });
};
/*
    POST, GET, PUT calls defined
 */


exports.getMenuItems = getMenuItems;

function postCall(url, mydata) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url; // resolve(axios.post(callingUrl, mydata)
    //     .then(response => {
    //         return response;
    //     }));

    _axios.default.post(callingUrl, mydata).then(response => {
      if (response.status === 200 || response.status === 201 || response.status === 401) {
        resolve(response);
      } else if (response.status === 500) {
        console.log("error calling api post call");
        reject();
      } else {
        console.log("unexpected error code");
        reject();
      }
    }).catch(err => {
      if (err.response.status === 401) {
        reject(err);
      }
    });
  });
}

function authenticatedGetCall(url, header) {
  const requestHeader = {
    headers: {
      "Authorization": "Bearer " + _config.apiConfig.authenticationToken
    }
  };
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.get(callingUrl, requestHeader).then(response => {
      return response;
    }));
  });
}

function putCall(url, updateOps) {
  return new Promise((resolve, reject) => {
    let callingUrl = baseUrl + url;
    resolve(_axios.default.put(callingUrl, updateOps).then(response => {
      return response;
    }));
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGxBcGkuanMiXSwibmFtZXMiOlsiYmFzZVVybCIsInJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwiYXBpQ29uZmlnIiwiYXV0aGVudGljYXRpb25Ub2tlbiIsInVzZXJMb2dpbiIsImNyZWRlbnRpYWxzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3N0Q2FsbCIsInRoZW4iLCJyZXN1bHQiLCJzdGF0dXMiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsInRva2VuIiwidXNlcklkIiwiaWQiLCJjYXRjaCIsImVyciIsInJlc3BvbnNlIiwibWVzc2FnZSIsImVycm9yQ29uc3RhbnRzIiwiZXJyb3IiLCJBVVRIX0ZBSUxFRCIsIk1FU1NBR0UiLCJjb2RlIiwiQ09ERSIsImdldE9yZGVySXRlbXMiLCJvcmRlcklkIiwiYXV0aGVudGljYXRlZEdldENhbGwiLCJ1cGRhdGVPcmRlciIsInVwZGF0ZU9wcyIsInB1dENhbGwiLCJnZXRVc2Vyc09yZGVycyIsImdldE1lbnVJdGVtcyIsInVybCIsIm15ZGF0YSIsImNhbGxpbmdVcmwiLCJheGlvcyIsInBvc3QiLCJoZWFkZXIiLCJnZXQiLCJwdXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLE9BQU8sR0FBRyx3QkFBaEI7QUFFQSxNQUFNQyxhQUFhLEdBQUc7QUFBRUMsRUFBQUEsT0FBTyxFQUFFO0FBQUUscUJBQWlCLFlBQVlDLGtCQUFVQztBQUF6QztBQUFYLENBQXRCOztBQUVPLE1BQU1DLFNBQVMsR0FBSUMsV0FBRCxJQUFpQjtBQUN0QyxTQUFPLElBQUlDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDcENDLElBQUFBLFFBQVEsQ0FBQyxhQUFELEVBQWdCSixXQUFoQixDQUFSLENBQ0tLLElBREwsQ0FDVUMsTUFBTSxJQUFJO0FBQ1osVUFBSUEsTUFBTSxDQUFDQyxNQUFQLEtBQWtCLEdBQXRCLEVBQTBCO0FBQ3RCQyxR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VCxDQUE4Qk0sR0FBOUIsRUFBbUNLLE1BQW5DLEVBQTJDO0FBQ3ZDLFFBQU0xQyxhQUFhLEdBQUc7QUFBRUMsSUFBQUEsT0FBTyxFQUFFO0FBQUUsdUJBQWlCLFlBQVlDLGtCQUFVQztBQUF6QztBQUFYLEdBQXRCO0FBRUEsU0FBTyxJQUFJRyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3BDLFFBQUkrQixVQUFVLEdBQUd4QyxPQUFPLEdBQUdzQyxHQUEzQjtBQUNBOUIsSUFBQUEsT0FBTyxDQUFDaUMsZUFBTUcsR0FBTixDQUFVSixVQUFWLEVBQXNCdkMsYUFBdEIsRUFDSFUsSUFERyxDQUNFVyxRQUFRLElBQUk7QUFDZCxhQUFPQSxRQUFQO0FBQ0gsS0FIRyxDQUFELENBQVA7QUFJSCxHQU5NLENBQVA7QUFPSDs7QUFHRCxTQUFTYSxPQUFULENBQWlCRyxHQUFqQixFQUFzQkosU0FBdEIsRUFBaUM7QUFDN0IsU0FBTyxJQUFJM0IsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxRQUFJK0IsVUFBVSxHQUFHeEMsT0FBTyxHQUFHc0MsR0FBM0I7QUFDQTlCLElBQUFBLE9BQU8sQ0FBQ2lDLGVBQU1JLEdBQU4sQ0FBVUwsVUFBVixFQUFxQk4sU0FBckIsRUFDSHZCLElBREcsQ0FDRVcsUUFBUSxJQUFJO0FBQ2QsYUFBT0EsUUFBUDtBQUNILEtBSEcsQ0FBRCxDQUFQO0FBSUgsR0FOTSxDQUFQO0FBT0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcGlDb25maWcgfSBmcm9tICcuLi9hcGlDYWxscy9jb25maWcnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IGVycm9yIH0gZnJvbSAnLi9lcnJvckNvbnN0YW50cyc7XG5cbmNvbnN0IGJhc2VVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9cIjtcblxuY29uc3QgcmVxdWVzdEhlYWRlciA9IHsgaGVhZGVyczogeyBcIkF1dGhvcml6YXRpb25cIjogXCJCZWFyZXIgXCIgKyBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiB9IH1cblxuZXhwb3J0IGNvbnN0IHVzZXJMb2dpbiA9IChjcmVkZW50aWFscykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHBvc3RDYWxsKFwidXNlcnMvbG9naW5cIiwgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcuYXV0aGVudGljYXRpb25Ub2tlbiA9IHJlc3VsdC5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBhcGlDb25maWcudXNlcklkID0gcmVzdWx0LmRhdGEuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG5cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVqZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSl7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvckNvbnN0YW50cy5lcnJvci5BVVRIX0ZBSUxFRC5NRVNTQUdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZXJyb3JDb25zdGFudHMuZXJyb3IuQVVUSF9GQUlMRUQuQ09ERVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKXtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yQ29uc3RhbnRzLkFVVEhfRkFJTEVELk1FU1NBR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBlcnJvckNvbnN0YW50cy5BVVRIX0ZBSUxFRC5DT0RFXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0T3JkZXJJdGVtcyA9IChvcmRlcklkKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvXCIrb3JkZXJJZClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuXG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtyZWplY3QoKX0pO1xuICAgIH0pO1xufVxuXG5cbmV4cG9ydCBjb25zdCB1cGRhdGVPcmRlciA9IChvcmRlcklkLCB1cGRhdGVPcHMpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBwdXRDYWxsKFwib3JkZXJzL1wiICsgb3JkZXJJZCwgdXBkYXRlT3BzKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7cmVqZWN0KCl9KTtcbiAgICB9KTtcbn1cblxuXG4vLyB0aGlzIG5lZWRzIHRvIGJlIGNoYW5nZWRcbmV4cG9ydCBjb25zdCBnZXRVc2Vyc09yZGVycyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhhcGlDb25maWcudXNlcklkKTtcbiAgICAgICAgYXV0aGVudGljYXRlZEdldENhbGwoXCJvcmRlcnMvYWxsL1wiICsgYXBpQ29uZmlnLnVzZXJJZClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge3JlamVjdCgpfSk7XG4gICAgfSk7XG59XG5cblxuZXhwb3J0IGNvbnN0IGdldE1lbnVJdGVtcyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBhdXRoZW50aWNhdGVkR2V0Q2FsbChcIml0ZW1zL1wiKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7cmVqZWN0KCl9KTtcbiAgICB9KTtcbn1cblxuXG4vKlxuICAgIFBPU1QsIEdFVCwgUFVUIGNhbGxzIGRlZmluZWRcbiAqL1xuXG5mdW5jdGlvbiBwb3N0Q2FsbCh1cmwsIG15ZGF0YSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgLy8gcmVzb2x2ZShheGlvcy5wb3N0KGNhbGxpbmdVcmwsIG15ZGF0YSlcbiAgICAgICAgLy8gICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIC8vICAgICB9KSk7XG4gICAgICAgIGF4aW9zLnBvc3QoY2FsbGluZ1VybCwgbXlkYXRhKVxuICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAxIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDUwMCl7XG4gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGNhbGxpbmcgYXBpIHBvc3QgY2FsbFwiKTtcbiAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInVuZXhwZWN0ZWQgZXJyb3IgY29kZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgKVxuICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpe1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gYXV0aGVudGljYXRlZEdldENhbGwodXJsLCBoZWFkZXIpIHtcbiAgICBjb25zdCByZXF1ZXN0SGVhZGVyID0geyBoZWFkZXJzOiB7IFwiQXV0aG9yaXphdGlvblwiOiBcIkJlYXJlciBcIiArIGFwaUNvbmZpZy5hdXRoZW50aWNhdGlvblRva2VuIH0gfTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgcmVzb2x2ZShheGlvcy5nZXQoY2FsbGluZ1VybCwgcmVxdWVzdEhlYWRlcilcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9KSk7XG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gcHV0Q2FsbCh1cmwsIHVwZGF0ZU9wcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBjYWxsaW5nVXJsID0gYmFzZVVybCArIHVybDtcbiAgICAgICAgcmVzb2x2ZShheGlvcy5wdXQoY2FsbGluZ1VybCx1cGRhdGVPcHMpXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfSkpO1xuICAgIH0pO1xufSJdfQ==